# Architecture Overview

> **For:** Deep technical context about system design decisions
> 
> **See also:**
> - `.cursorrules` - Complete patterns and examples for AI assistants
> - `component-checklist.md` - Quick reference checklist
> - `writing-usage-guidance.md` - JSDoc writing guide

## File Structure
```
src/
├── components/     # UI components (kebab-case folders/files)
├── provider/       # Tamagui config + UIProvider
└── index.ts        # Main exports

dev/                # Development environments (NOT shipped)
├── web/            # Vite + Storybook for web
├── native/         # Expo + Storybook for iOS/Android
└── stories/        # Shared stories for both environments (kebab-case files)
```

## Development Environment

**IMPORTANT:** The `dev/` directory contains development-only applications for testing components. These do NOT ship with the npm package.

### dev/web - Web Storybook
- **Tech:** Vite + Storybook
- **Purpose:** Visual testing of components in browser
- **Start:** `cd dev/web && yarn storybook`
- **URL:** Usually http://localhost:6006
- **Config:** Storybook config in `dev/web/` (if present) or uses defaults
- **Wraps stories with:** UIProvider for Tamagui tokens

### dev/native - Native Storybook
- **Tech:** Expo + Storybook (React Native)
- **Purpose:** Visual testing on iOS/Android simulators/devices
- **Start:** `cd dev/native && yarn start`
- **Platforms:** iOS Simulator, Android Emulator, Physical devices
- **Config:** Expo configuration in `dev/native/app.json`
- **Wraps stories with:** UIProvider for Tamagui tokens

### dev/stories - Shared Stories
- **Shared across:** Both web and native Storybooks
- **Format:** `{ComponentName}.stories.tsx` (PascalCase for Storybook titles)
- **Imports from:** `@puzzlebottom/totm-ui-components` (the package)
- **Purpose:** 
  - Visual testing during development
  - Use-case demonstrations (internal reference)
  - Does NOT ship with package

**Key Difference from JSDoc:**
- Stories = dev-only, internal testing/reference
- JSDoc = ships with package, consumers see in IDE

## Platform Resolution

### How Files Are Resolved

**Web bundlers (Vite/Webpack):**
- Look for `component-name.tsx` first
- Use this as the default implementation

**React Native (Metro):**
- Look for `component-name.native.tsx` first
- Fall back to `component-name.tsx` if not found

### When to Split Platforms

**Split into `.native.tsx` when:**
- Using native-only APIs (MaskedView, Animated, Linking, etc.)
- Need different rendering (CSS vs native primitives)
- Performance optimizations specific to platform

**Examples:**
- `gradient-text.tsx` - Uses CSS `background-clip: text`
- `gradient-text.native.tsx` - Uses `MaskedView` component

**Keep unified when:**
- Component only uses Tamagui primitives
- Logic is platform-agnostic
- Same implementation works everywhere

## Component Patterns

See `.cursorrules` for complete component and story templates.

**Key principles:**
1. Extend Tamagui primitives (Stack, Text, etc.)
2. Export types with components
3. Write comprehensive JSDoc (see `writing-usage-guidance.md`)

## Adding New Components

See `component-checklist.md` for step-by-step checklist.

## Build System

### What Gets Built
- **Source files** (`components/`, `provider/`) - Shipped as TypeScript
- **Type declarations** (`dist/`) - Generated by `tsc` for IDE support

### Why Ship Source?
- Better tree-shaking by consumer's bundler
- No dual-instance issues with Tamagui
- Consumers' bundlers optimize based on their target
- Smaller package size (no pre-bundled code)

### Build Commands
```bash
yarn build  # Generate types once
yarn dev    # Watch mode for type generation
yarn clean  # Remove generated types
```

## Package Structure

**What's shipped in npm package:**
- Source files: `components/`, `provider/`, `index.ts`
- Type declarations: `dist/`
- No bundled JavaScript (consumers bundle from source)

**How consumers use it:**
- Web bundlers compile TypeScript source directly
- React Native Metro compiles TypeScript source directly
- Both use generated `.d.ts` for fast IDE autocomplete

## Naming Conventions

**Files/Folders:** kebab-case  
**Exports:** PascalCase  
**Variables:** camelCase

See `.cursorrules` for complete convention table.

